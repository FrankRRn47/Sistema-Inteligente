{"ast":null,"code":"import _objectSpread from\"C:/Users/Loq/Desktop/gatoportafolio/EmocionesDos - versioncuatroedit01 - 100% funcional - vedit/SIMPACeditDos/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useCallback,useEffect,useRef,useState}from'react';import MediaResultCard from'../components/MediaResultCard.jsx';import{analyzeImageUpload,analyzeVideoUpload,analyzeWebcamUpload,analyzeWebcamFrame,startLiveSession,stopLiveSession,fetchMediaHistory,fetchModelMetadata}from'../services/mediaService.js';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function MediaLab(){var _liveSessionSummary$a,_metadata$labels,_livePanelData$confid,_livePanelData$confid2;const[filterOpen,setFilterOpen]=useState(false);const[metadata,setMetadata]=useState(null);const[history,setHistory]=useState([]);const[latestResults,setLatestResults]=useState([]);const[availableEmotions,setAvailableEmotions]=useState([]);const[historyFilters,setHistoryFilters]=useState({mediaType:'image',emotion:'all'});const[historyLoading,setHistoryLoading]=useState(false);const[historyError,setHistoryError]=useState('');const[imageFile,setImageFile]=useState(null);const[imageChannel,setImageChannel]=useState('manual');const[imageError,setImageError]=useState('');const[imageLoading,setImageLoading]=useState(false);const[videoFile,setVideoFile]=useState(null);const[videoChannel,setVideoChannel]=useState('manual');const[videoError,setVideoError]=useState('');const[videoLoading,setVideoLoading]=useState(false);const[webcamChannel,setWebcamChannel]=useState('webcam');const[webcamError,setWebcamError]=useState('');const[webcamLoading,setWebcamLoading]=useState(false);const[isPreviewActive,setIsPreviewActive]=useState(false);const[isRecording,setIsRecording]=useState(false);const[recordingBlob,setRecordingBlob]=useState(null);const[isLiveActive,setIsLiveActive]=useState(false);const[liveResult,setLiveResult]=useState(null);const[liveStatus,setLiveStatus]=useState('IA en espera');const[liveError,setLiveError]=useState('');const[liveSessionId,setLiveSessionId]=useState(null);const[liveSessionStats,setLiveSessionStats]=useState(null);const[liveSessionSummary,setLiveSessionSummary]=useState(null);const videoRef=useRef(null);const streamRef=useRef(null);const recorderRef=useRef(null);const overlayRef=useRef(null);const captureCanvasRef=useRef(null);const liveIntervalRef=useRef(null);const liveRequestRef=useRef(false);const webcamChannelRef=useRef(webcamChannel);const liveSessionIdRef=useRef(liveSessionId);const emotionOptions=availableEmotions.length>0?availableEmotions:(metadata===null||metadata===void 0?void 0:metadata.labels)||[];const refreshHistory=useCallback(async()=>{setHistoryLoading(true);setHistoryError('');try{var _response$filters;const response=await fetchMediaHistory({limit:12,mediaType:historyFilters.mediaType,emotion:historyFilters.emotion});setHistory(response.items||[]);setAvailableEmotions(((_response$filters=response.filters)===null||_response$filters===void 0?void 0:_response$filters.available_emotions)||[]);}catch(error){var _error$response,_error$response$data;setHistoryError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'No se pudo cargar el historial.');}finally{setHistoryLoading(false);}},[historyFilters]);const pushAnalyses=useCallback(function(){let analyses=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(!Array.isArray(analyses)||analyses.length===0){return;}setLatestResults(prev=>[...analyses,...prev].slice(0,5));const filtered=analyses.filter(analysis=>{const matchesType=historyFilters.mediaType==='all'||analysis.media_type===historyFilters.mediaType;const matchesEmotion=historyFilters.emotion==='all'||analysis.dominant_emotion===historyFilters.emotion;return matchesType&&matchesEmotion;});if(filtered.length>0){setHistory(prev=>[...filtered,...prev].slice(0,12));}refreshHistory().catch(()=>{});},[historyFilters,refreshHistory]);const closeLiveSession=useCallback(async()=>{const sessionId=liveSessionIdRef.current;if(!sessionId){return null;}try{var _response$analyses;const response=await stopLiveSession(sessionId);setLiveSessionSummary(response);setLiveSessionStats(response);if((_response$analyses=response.analyses)!==null&&_response$analyses!==void 0&&_response$analyses.length){pushAnalyses(response.analyses);}return response;}catch(error){var _error$response2,_error$response2$data;setLiveError(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||'No se pudo cerrar la sesión en vivo.');return null;}finally{setLiveSessionId(null);liveSessionIdRef.current=null;}},[pushAnalyses]);const clearOverlay=useCallback(()=>{const canvas=overlayRef.current;if(canvas){const ctx=canvas.getContext('2d');ctx.clearRect(0,0,canvas.width,canvas.height);}},[]);const stopLiveLoop=useCallback(async()=>{if(liveIntervalRef.current){clearInterval(liveIntervalRef.current);liveIntervalRef.current=null;}liveRequestRef.current=false;const hadSession=Boolean(liveSessionIdRef.current);setIsLiveActive(false);setLiveStatus('IA en espera');setLiveResult(null);if(!hadSession){setLiveSessionStats(null);}clearOverlay();if(hadSession){await closeLiveSession();}},[clearOverlay,closeLiveSession]);const drawDetections=useCallback(summary=>{const overlay=overlayRef.current;const videoElement=videoRef.current;if(!overlay||!videoElement){return;}const displayWidth=videoElement.clientWidth||videoElement.videoWidth;const displayHeight=videoElement.clientHeight||videoElement.videoHeight;const intrinsicWidth=videoElement.videoWidth||displayWidth;const intrinsicHeight=videoElement.videoHeight||displayHeight;if(!displayWidth||!displayHeight||!intrinsicWidth||!intrinsicHeight){return;}overlay.width=displayWidth;overlay.height=displayHeight;overlay.style.width=\"\".concat(displayWidth,\"px\");overlay.style.height=\"\".concat(displayHeight,\"px\");const ctx=overlay.getContext('2d');ctx.clearRect(0,0,overlay.width,overlay.height);const scaleX=displayWidth/intrinsicWidth;const scaleY=displayHeight/intrinsicHeight;const detections=(summary===null||summary===void 0?void 0:summary.detections)||[];if(detections.length===0){setLiveStatus('IA en vivo: buscando rostros...');return;}ctx.lineWidth=2;ctx.font=\"\".concat(Math.max(14,overlay.width*0.018),\"px 'Space Grotesk', sans-serif\");detections.forEach(_ref=>{let{box,label,confidence}=_ref;const[rawX,rawY,rawW,rawH]=box;const x=rawX*scaleX;const y=rawY*scaleY;const w=rawW*scaleX;const h=rawH*scaleY;ctx.strokeStyle='#22d3ee';ctx.strokeRect(x,y,w,h);const text=\"\".concat(label,\" \").concat((confidence*100).toFixed(1),\"%\");const textWidth=ctx.measureText(text).width+10;const textHeight=parseInt(ctx.font,10)+6;const labelY=Math.max(y-textHeight,0);ctx.fillStyle='rgba(15, 23, 42, 0.8)';ctx.fillRect(x-2,labelY,textWidth,textHeight);ctx.fillStyle='#fff';ctx.fillText(text,x+2,labelY+4);});},[setLiveStatus]);useEffect(()=>{if(typeof document!=='undefined'&&!captureCanvasRef.current){captureCanvasRef.current=document.createElement('canvas');}return()=>{captureCanvasRef.current=null;};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(()=>{webcamChannelRef.current=webcamChannel;},[webcamChannel]);useEffect(()=>{liveSessionIdRef.current=liveSessionId;},[liveSessionId]);useEffect(()=>{refreshHistory().catch(()=>{});},[refreshHistory]);useEffect(()=>{const loadBootstrapData=async()=>{try{const metaResponse=await fetchModelMetadata();setMetadata(metaResponse);}catch(error){var _error$response3,_error$response3$data;setWebcamError(((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.message)||'No se pudo obtener la configuración del modelo.');}};loadBootstrapData();return()=>{stopCamera();};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);const updateHistoryFilter=field=>event=>{const value=event.target.value;setHistoryFilters(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));};const handleImageSubmit=async event=>{event.preventDefault();if(!imageFile){setImageError('Selecciona una imagen antes de enviar.');return;}setImageLoading(true);setImageError('');try{const response=await analyzeImageUpload(imageFile,imageChannel);pushAnalyses(response.analyses);}catch(error){var _error$response4,_error$response4$data;setImageError(((_error$response4=error.response)===null||_error$response4===void 0?void 0:(_error$response4$data=_error$response4.data)===null||_error$response4$data===void 0?void 0:_error$response4$data.message)||'No se pudo analizar la imagen.');}finally{setImageLoading(false);}};const handleVideoSubmit=async event=>{event.preventDefault();if(!videoFile){setVideoError('Selecciona un video MP4/WebM antes de enviar.');return;}setVideoLoading(true);setVideoError('');try{const response=await analyzeVideoUpload(videoFile,videoChannel);pushAnalyses(response.analyses);}catch(error){var _error$response5,_error$response5$data;setVideoError(((_error$response5=error.response)===null||_error$response5===void 0?void 0:(_error$response5$data=_error$response5.data)===null||_error$response5$data===void 0?void 0:_error$response5$data.message)||'No se pudo analizar el video.');}finally{setVideoLoading(false);}};const startCamera=async()=>{var _navigator$mediaDevic;if(isPreviewActive)return;if(!((_navigator$mediaDevic=navigator.mediaDevices)!==null&&_navigator$mediaDevic!==void 0&&_navigator$mediaDevic.getUserMedia)){setWebcamError('La API de cámara no está disponible en este navegador.');setLiveError('');return;}try{const stream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});streamRef.current=stream;if(videoRef.current){videoRef.current.srcObject=stream;}setIsPreviewActive(true);setWebcamError('');setLiveError('');setLiveStatus('IA en espera');setLiveResult(null);setLiveSessionStats(null);setLiveSessionSummary(null);clearOverlay();}catch(error){setWebcamError('No pudimos acceder a la cámara. Revisa los permisos del navegador o cierra otras aplicaciones que la estén usando.');setLiveError('');}};const stopCamera=useCallback(()=>{var _streamRef$current;stopLiveLoop().catch(()=>{});(_streamRef$current=streamRef.current)===null||_streamRef$current===void 0?void 0:_streamRef$current.getTracks().forEach(track=>track.stop());streamRef.current=null;if(videoRef.current){videoRef.current.srcObject=null;}setIsPreviewActive(false);setIsRecording(false);setRecordingBlob(null);setLiveError('');setLiveResult(null);setLiveStatus('IA en espera');},[stopLiveLoop]);const startLiveLoop=useCallback(async()=>{if(!streamRef.current||!videoRef.current){setLiveError('Activa la cámara antes de iniciar la IA en vivo.');return;}if(!captureCanvasRef.current&&typeof document!=='undefined'){captureCanvasRef.current=document.createElement('canvas');}if(liveIntervalRef.current||liveRequestRef.current||liveSessionIdRef.current){return;}let sessionResponse;try{sessionResponse=await startLiveSession(webcamChannelRef.current);}catch(error){var _error$response6,_error$response6$data,_error$response7,_error$response7$data,_error$response8,_error$response9;const apiMessage=((_error$response6=error.response)===null||_error$response6===void 0?void 0:(_error$response6$data=_error$response6.data)===null||_error$response6$data===void 0?void 0:_error$response6$data.message)||((_error$response7=error.response)===null||_error$response7===void 0?void 0:(_error$response7$data=_error$response7.data)===null||_error$response7$data===void 0?void 0:_error$response7$data.msg);if(((_error$response8=error.response)===null||_error$response8===void 0?void 0:_error$response8.status)===401||((_error$response9=error.response)===null||_error$response9===void 0?void 0:_error$response9.status)===422){setLiveError('Tu sesión expiró. Inicia sesión nuevamente para usar la cámara en vivo.');}else{setLiveError(apiMessage||'No se pudo iniciar la sesión en vivo.');}return;}setLiveSessionId(sessionResponse.session_id);liveSessionIdRef.current=sessionResponse.session_id;setLiveSessionStats(null);setLiveSessionSummary(null);const captureAndAnalyze=async()=>{var _videoRef$current;if(!((_videoRef$current=videoRef.current)!==null&&_videoRef$current!==void 0&&_videoRef$current.videoWidth)||!captureCanvasRef.current){return;}if(liveRequestRef.current){return;}liveRequestRef.current=true;const canvas=captureCanvasRef.current;canvas.width=videoRef.current.videoWidth;canvas.height=videoRef.current.videoHeight;const ctx=canvas.getContext('2d');ctx.drawImage(videoRef.current,0,0,canvas.width,canvas.height);const blob=await new Promise(resolve=>canvas.toBlob(resolve,'image/jpeg',0.9));if(!blob){liveRequestRef.current=false;return;}try{const file=new File([blob],\"webcam-frame-\".concat(Date.now(),\".jpg\"),{type:'image/jpeg'});const response=await analyzeWebcamFrame(file,webcamChannelRef.current,liveSessionIdRef.current);setLiveResult(response);setLiveStatus(\"IA en vivo: \".concat(response.dominant_emotion,\" \").concat((response.confidence*100).toFixed(1),\"%\"));drawDetections(response);setLiveError('');if(response.session){setLiveSessionStats(response.session);}}catch(error){var _error$response0,_error$response0$data,_error$response1;const apiMessage=((_error$response0=error.response)===null||_error$response0===void 0?void 0:(_error$response0$data=_error$response0.data)===null||_error$response0$data===void 0?void 0:_error$response0$data.message)||'No se pudo analizar el fotograma de la cámara.';if(((_error$response1=error.response)===null||_error$response1===void 0?void 0:_error$response1.status)===400){setLiveStatus(\"IA en vivo: \".concat(apiMessage));setLiveError('');clearOverlay();}else{setLiveError(apiMessage);stopLiveLoop().catch(()=>{});}}finally{liveRequestRef.current=false;}};setIsLiveActive(true);setLiveStatus('IA en vivo: calibrando cámara...');setLiveError('');captureAndAnalyze();liveIntervalRef.current=window.setInterval(captureAndAnalyze,1800);},[drawDetections,stopLiveLoop]);useEffect(()=>{if(!isPreviewActive){return undefined;}const handleKeyPress=event=>{var _event$key;const key=(_event$key=event.key)===null||_event$key===void 0?void 0:_event$key.toLowerCase();if(key==='p'){event.preventDefault();startLiveLoop().catch(()=>{});}else if(key==='q'){event.preventDefault();if(isLiveActive){stopLiveLoop().catch(()=>{});}stopCamera();}};window.addEventListener('keydown',handleKeyPress);return()=>{window.removeEventListener('keydown',handleKeyPress);};},[isPreviewActive,isLiveActive,startLiveLoop,stopLiveLoop,stopCamera]);const startRecording=()=>{if(!streamRef.current){setWebcamError('Activa la cámara antes de grabar.');return;}if(isRecording)return;if(typeof MediaRecorder==='undefined'){setWebcamError('MediaRecorder no es compatible con este navegador.');return;}let recorder;try{recorder=new MediaRecorder(streamRef.current,{mimeType:'video/webm;codecs=vp9'});}catch(error){try{recorder=new MediaRecorder(streamRef.current);}catch(err){setWebcamError('No se pudo iniciar la grabación en este navegador.');return;}}const chunks=[];recorder.ondataavailable=event=>{var _event$data;if((_event$data=event.data)!==null&&_event$data!==void 0&&_event$data.size){chunks.push(event.data);}};recorder.onstop=()=>{setIsRecording(false);const blob=new Blob(chunks,{type:'video/webm'});setRecordingBlob(blob);};recorder.onerror=()=>{setWebcamError('Ocurrió un error durante la grabación.');recorder.stop();};recorder.start();recorderRef.current=recorder;setIsRecording(true);setTimeout(()=>{if(recorder.state!=='inactive'){recorder.stop();}},5000);};const stopRecording=()=>{if(recorderRef.current&&recorderRef.current.state!=='inactive'){recorderRef.current.stop();}};const handleWebcamSubmit=async()=>{if(!recordingBlob){setWebcamError('Graba un clip antes de enviarlo.');return;}setWebcamLoading(true);setWebcamError('');try{const file=new File([recordingBlob],\"webcam-\".concat(Date.now(),\".webm\"),{type:recordingBlob.type||'video/webm'});const response=await analyzeWebcamUpload(file,webcamChannel);pushAnalyses(response.analyses);setRecordingBlob(null);}catch(error){var _error$response10,_error$response10$dat;setWebcamError(((_error$response10=error.response)===null||_error$response10===void 0?void 0:(_error$response10$dat=_error$response10.data)===null||_error$response10$dat===void 0?void 0:_error$response10$dat.message)||'No se pudo analizar la captura de la cámara.');}finally{setWebcamLoading(false);}};const livePanelData=liveSessionStats||liveResult;const livePanelCounts=(livePanelData===null||livePanelData===void 0?void 0:livePanelData.counts)||{};const liveSummaryAnalyses=liveSessionSummary!==null&&liveSessionSummary!==void 0&&(_liveSessionSummary$a=liveSessionSummary.analyses)!==null&&_liveSessionSummary$a!==void 0&&_liveSessionSummary$a.length?liveSessionSummary.analyses:liveSessionSummary!==null&&liveSessionSummary!==void 0&&liveSessionSummary.analysis?[liveSessionSummary.analysis]:[];const liveSummaryPrimary=liveSummaryAnalyses[0];const resolveEmotionCount=analysis=>{var _analysis$detections,_analysis$detections2,_analysis$detections3,_analysis$emotion_cou;if(!analysis)return 0;if(((_analysis$detections=analysis.detections)===null||_analysis$detections===void 0?void 0:_analysis$detections.emotion_count)!=null){return analysis.detections.emotion_count;}if(((_analysis$detections2=analysis.detections)===null||_analysis$detections2===void 0?void 0:(_analysis$detections3=_analysis$detections2.counts)===null||_analysis$detections3===void 0?void 0:_analysis$detections3[analysis.dominant_emotion])!=null){return analysis.detections.counts[analysis.dominant_emotion];}if((_analysis$emotion_cou=analysis.emotion_counts)!==null&&_analysis$emotion_cou!==void 0&&_analysis$emotion_cou.length){return analysis.emotion_counts[0].count;}return 1;};return/*#__PURE__*/_jsxs(\"section\",{className:\"app-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"page-header\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"page-title\",children:\"Laboratorio multimedia\"}),/*#__PURE__*/_jsx(\"p\",{className:\"page-subtitle\",children:\"Carga im\\xE1genes, videos o captura directamente desde la c\\xE1mara para detectar emociones en tiempo real.\"})]}),metadata&&/*#__PURE__*/_jsxs(\"div\",{className:\"card media-info-card\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Modelo activo\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Pesos: \",metadata.weights_path]}),/*#__PURE__*/_jsx(\"div\",{className:\"media-pills\",children:(_metadata$labels=metadata.labels)===null||_metadata$labels===void 0?void 0:_metadata$labels.map(label=>/*#__PURE__*/_jsx(\"span\",{className:\"media-pill\",children:label},label))})]}),/*#__PURE__*/_jsx(\"div\",{className:\"media-camera-wrapper\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card media-card media-webcam-card\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Capturar desde la c\\xE1mara\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Activa la c\\xE1mara, habilita la IA en vivo para ver detecciones sobre el rostro o graba un clip de 5 segundos.\"}),/*#__PURE__*/_jsx(\"div\",{className:\"media-webcam\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"media-webcam-layout\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"media-webcam-preview\",children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,className:\"media-preview\",autoPlay:true,muted:true,playsInline:true}),/*#__PURE__*/_jsx(\"canvas\",{ref:overlayRef,className:\"media-overlay\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"media-webcam-panel\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"media-live-status\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"media-live-indicator \".concat(isLiveActive?'on':'')}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"media-live-headline\",children:liveStatus}),livePanelData&&/*#__PURE__*/_jsxs(\"p\",{className:\"media-live-subtitle\",children:[\"Dominante: \",/*#__PURE__*/_jsx(\"strong\",{children:livePanelData.dominant_emotion||'Sin detección'}),\" \\xB7 \",(((_livePanelData$confid=livePanelData.confidence)!==null&&_livePanelData$confid!==void 0?_livePanelData$confid:0)*100).toFixed(1),\"%\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"media-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"secondary-btn\",onClick:startCamera,disabled:isPreviewActive,children:\"Activar c\\xE1mara\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"secondary-btn\",onClick:stopCamera,children:\"Detener c\\xE1mara\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"secondary-btn\",onClick:startRecording,disabled:!isPreviewActive||isRecording,children:isRecording?'Grabando...':'Grabar 5s'}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"secondary-btn\",onClick:stopRecording,disabled:!isRecording,children:\"Detener grabaci\\xF3n\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"media-actions media-live-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"secondary-btn\",onClick:()=>startLiveLoop().catch(()=>{}),disabled:!isPreviewActive||isLiveActive,children:isLiveActive?'IA en vivo activa':'Activar IA en vivo'}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"secondary-btn\",onClick:()=>stopLiveLoop().catch(()=>{}),disabled:!isLiveActive&&!liveSessionId,children:\"Detener IA en vivo\"})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"media-hint\",children:[\"Atajos: presiona \",/*#__PURE__*/_jsx(\"strong\",{children:\"P\"}),\" para iniciar la IA en vivo y \",/*#__PURE__*/_jsx(\"strong\",{children:\"Q\"}),\" para detener la c\\xE1mara.\"]}),recordingBlob&&/*#__PURE__*/_jsxs(\"p\",{className:\"media-hint\",children:[\"Clip listo para enviar (\",(recordingBlob.size/1024/1024).toFixed(2),\" MB)\"]}),webcamError&&/*#__PURE__*/_jsx(\"p\",{className:\"media-error\",children:webcamError}),liveError&&/*#__PURE__*/_jsx(\"p\",{className:\"media-error\",children:liveError}),/*#__PURE__*/_jsx(\"button\",{className:\"primary-btn\",type:\"button\",onClick:handleWebcamSubmit,disabled:webcamLoading||!recordingBlob,children:webcamLoading?'Enviando...':'Analizar clip grabado'}),livePanelData&&/*#__PURE__*/_jsxs(\"div\",{className:\"media-live-panel\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"media-live-emotion\",children:[livePanelData.dominant_emotion||'Sin detección',/*#__PURE__*/_jsxs(\"span\",{children:[(((_livePanelData$confid2=livePanelData.confidence)!==null&&_livePanelData$confid2!==void 0?_livePanelData$confid2:0)*100).toFixed(1),\"%\"]})]}),Object.keys(livePanelCounts).length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"media-live-counts\",children:Object.entries(livePanelCounts).map(_ref2=>{let[label,qty]=_ref2;return/*#__PURE__*/_jsxs(\"span\",{children:[label,/*#__PURE__*/_jsx(\"strong\",{children:qty})]},label);})}),(liveSessionStats===null||liveSessionStats===void 0?void 0:liveSessionStats.frames)&&/*#__PURE__*/_jsxs(\"p\",{className:\"media-hint\",style:{margin:0},children:[\"Muestras procesadas: \",liveSessionStats.frames,(liveSessionSummary===null||liveSessionSummary===void 0?void 0:liveSessionSummary.duration_seconds)&&/*#__PURE__*/_jsxs(\"span\",{children:[\" \\xB7 Duraci\\xF3n \",(liveSessionSummary.duration_seconds/60).toFixed(1),\" min\"]})]})]}),liveSummaryAnalyses.length>0&&liveSummaryPrimary&&/*#__PURE__*/_jsxs(\"div\",{className:\"media-live-panel\",style:{background:'rgba(22, 163, 74, 0.1)'},children:[/*#__PURE__*/_jsxs(\"p\",{className:\"media-live-emotion\",style:{fontSize:'1rem'},children:[\"Sesi\\xF3n guardada correctamente\",/*#__PURE__*/_jsxs(\"span\",{children:[new Date(liveSummaryPrimary.created_at).toLocaleTimeString(),\" \\xB7 \",liveSummaryAnalyses.length,' ',liveSummaryAnalyses.length===1?'emoción':'emociones']})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"media-links\",children:[liveSummaryPrimary.snapshot_url&&/*#__PURE__*/_jsx(\"a\",{href:liveSummaryPrimary.snapshot_url,target:\"_blank\",rel:\"noreferrer\",children:\"Ver captura principal\"}),liveSummaryPrimary.original_url&&/*#__PURE__*/_jsx(\"a\",{href:liveSummaryPrimary.original_url,target:\"_blank\",rel:\"noreferrer\",children:\"Descargar sesi\\xF3n\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"media-live-counts\",children:liveSummaryAnalyses.map(analysis=>/*#__PURE__*/_jsxs(\"span\",{children:[analysis.dominant_emotion,/*#__PURE__*/_jsx(\"strong\",{children:resolveEmotionCount(analysis)})]},\"live-summary-\".concat(analysis.id)))})]})]})]})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"media-upload-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card media-card\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Analizar imagen\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Carga una fotograf\\xEDa (JPG, PNG, WEBP) y obt\\xE9n el sentimiento dominante.\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleImageSubmit,className:\"media-form\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:event=>{var _event$target$files;return setImageFile(((_event$target$files=event.target.files)===null||_event$target$files===void 0?void 0:_event$target$files[0])||null);}}),imageError&&/*#__PURE__*/_jsx(\"p\",{className:\"media-error\",children:imageError}),/*#__PURE__*/_jsx(\"button\",{className:\"primary-btn\",type:\"submit\",disabled:imageLoading,children:imageLoading?'Analizando...':'Procesar imagen'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card media-card\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Analizar video\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Sube un clip MP4/MOV/WebM para procesar m\\xFAltiples fotogramas.\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleVideoSubmit,className:\"media-form\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"video/mp4,video/webm,video/quicktime\",onChange:event=>{var _event$target$files2;return setVideoFile(((_event$target$files2=event.target.files)===null||_event$target$files2===void 0?void 0:_event$target$files2[0])||null);}}),videoError&&/*#__PURE__*/_jsx(\"p\",{className:\"media-error\",children:videoError}),/*#__PURE__*/_jsx(\"button\",{className:\"primary-btn\",type:\"submit\",disabled:videoLoading,children:videoLoading?'Analizando...':'Procesar video'})]})]})]}),latestResults.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'2rem'},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\xDAltimos resultados\"}),/*#__PURE__*/_jsx(\"div\",{className:\"media-result-list\",children:latestResults.map(item=>/*#__PURE__*/_jsx(MediaResultCard,{item:item},\"\".concat(item.id,\"-\").concat(item.created_at)))})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'2rem'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"media-history-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Historial almacenado\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"media-filter-bar\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Tipo de medio\",/*#__PURE__*/_jsxs(\"select\",{value:historyFilters.mediaType,onChange:updateHistoryFilter('mediaType'),children:[/*#__PURE__*/_jsx(\"option\",{value:\"image\",children:\"Fotos\"}),/*#__PURE__*/_jsx(\"option\",{value:\"video\",children:\"Videos\"}),/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"Todos\"})]})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Sentimiento\",/*#__PURE__*/_jsxs(\"select\",{value:historyFilters.emotion,onChange:updateHistoryFilter('emotion'),children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"Todos\"}),emotionOptions.map(label=>/*#__PURE__*/_jsx(\"option\",{value:label,children:label},label))]})]})]})]}),historyError&&/*#__PURE__*/_jsx(\"p\",{className:\"media-error\",children:historyError}),historyLoading?/*#__PURE__*/_jsx(\"p\",{className:\"media-hint\",children:\"Cargando registros...\"}):history.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"media-hint\",children:\"A\\xFAn no hay registros almacenados para este usuario.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"media-result-list\",children:history.map(item=>/*#__PURE__*/_jsx(MediaResultCard,{item:item},\"history-\".concat(item.id)))})]})]});}export default MediaLab;","map":{"version":3,"names":["useCallback","useEffect","useRef","useState","MediaResultCard","analyzeImageUpload","analyzeVideoUpload","analyzeWebcamUpload","analyzeWebcamFrame","startLiveSession","stopLiveSession","fetchMediaHistory","fetchModelMetadata","jsx","_jsx","jsxs","_jsxs","MediaLab","_liveSessionSummary$a","_metadata$labels","_livePanelData$confid","_livePanelData$confid2","filterOpen","setFilterOpen","metadata","setMetadata","history","setHistory","latestResults","setLatestResults","availableEmotions","setAvailableEmotions","historyFilters","setHistoryFilters","mediaType","emotion","historyLoading","setHistoryLoading","historyError","setHistoryError","imageFile","setImageFile","imageChannel","setImageChannel","imageError","setImageError","imageLoading","setImageLoading","videoFile","setVideoFile","videoChannel","setVideoChannel","videoError","setVideoError","videoLoading","setVideoLoading","webcamChannel","setWebcamChannel","webcamError","setWebcamError","webcamLoading","setWebcamLoading","isPreviewActive","setIsPreviewActive","isRecording","setIsRecording","recordingBlob","setRecordingBlob","isLiveActive","setIsLiveActive","liveResult","setLiveResult","liveStatus","setLiveStatus","liveError","setLiveError","liveSessionId","setLiveSessionId","liveSessionStats","setLiveSessionStats","liveSessionSummary","setLiveSessionSummary","videoRef","streamRef","recorderRef","overlayRef","captureCanvasRef","liveIntervalRef","liveRequestRef","webcamChannelRef","liveSessionIdRef","emotionOptions","length","labels","refreshHistory","_response$filters","response","limit","items","filters","available_emotions","error","_error$response","_error$response$data","data","message","pushAnalyses","analyses","arguments","undefined","Array","isArray","prev","slice","filtered","filter","analysis","matchesType","media_type","matchesEmotion","dominant_emotion","catch","closeLiveSession","sessionId","current","_response$analyses","_error$response2","_error$response2$data","clearOverlay","canvas","ctx","getContext","clearRect","width","height","stopLiveLoop","clearInterval","hadSession","Boolean","drawDetections","summary","overlay","videoElement","displayWidth","clientWidth","videoWidth","displayHeight","clientHeight","videoHeight","intrinsicWidth","intrinsicHeight","style","concat","scaleX","scaleY","detections","lineWidth","font","Math","max","forEach","_ref","box","label","confidence","rawX","rawY","rawW","rawH","x","y","w","h","strokeStyle","strokeRect","text","toFixed","textWidth","measureText","textHeight","parseInt","labelY","fillStyle","fillRect","fillText","document","createElement","loadBootstrapData","metaResponse","_error$response3","_error$response3$data","stopCamera","updateHistoryFilter","field","event","value","target","_objectSpread","handleImageSubmit","preventDefault","_error$response4","_error$response4$data","handleVideoSubmit","_error$response5","_error$response5$data","startCamera","_navigator$mediaDevic","navigator","mediaDevices","getUserMedia","stream","video","audio","srcObject","_streamRef$current","getTracks","track","stop","startLiveLoop","sessionResponse","_error$response6","_error$response6$data","_error$response7","_error$response7$data","_error$response8","_error$response9","apiMessage","msg","status","session_id","captureAndAnalyze","_videoRef$current","drawImage","blob","Promise","resolve","toBlob","file","File","Date","now","type","session","_error$response0","_error$response0$data","_error$response1","window","setInterval","handleKeyPress","_event$key","key","toLowerCase","addEventListener","removeEventListener","startRecording","MediaRecorder","recorder","mimeType","err","chunks","ondataavailable","_event$data","size","push","onstop","Blob","onerror","start","setTimeout","state","stopRecording","handleWebcamSubmit","_error$response10","_error$response10$dat","livePanelData","livePanelCounts","counts","liveSummaryAnalyses","liveSummaryPrimary","resolveEmotionCount","_analysis$detections","_analysis$detections2","_analysis$detections3","_analysis$emotion_cou","emotion_count","emotion_counts","count","className","children","weights_path","map","ref","autoPlay","muted","playsInline","onClick","disabled","Object","keys","entries","_ref2","qty","frames","margin","duration_seconds","background","fontSize","created_at","toLocaleTimeString","snapshot_url","href","rel","original_url","id","onSubmit","accept","onChange","_event$target$files","files","_event$target$files2","marginTop","item"],"sources":["C:/Users/Loq/Desktop/gatoportafolio/EmocionesDos - versioncuatroedit01 - 100% funcional - vedit/SIMPACeditDos/frontend/src/pages/MediaLab.jsx"],"sourcesContent":["import { useCallback, useEffect, useRef, useState } from 'react';\r\n\r\nimport MediaResultCard from '../components/MediaResultCard.jsx';\r\nimport {\r\n  analyzeImageUpload,\r\n  analyzeVideoUpload,\r\n  analyzeWebcamUpload,\r\n  analyzeWebcamFrame,\r\n  startLiveSession,\r\n  stopLiveSession,\r\n  fetchMediaHistory,\r\n  fetchModelMetadata,\r\n} from '../services/mediaService.js';\r\n\r\nfunction MediaLab() {\r\n    const [filterOpen, setFilterOpen] = useState(false);\r\n  const [metadata, setMetadata] = useState(null);\r\n  const [history, setHistory] = useState([]);\r\n  const [latestResults, setLatestResults] = useState([]);\r\n  const [availableEmotions, setAvailableEmotions] = useState([]);\r\n  const [historyFilters, setHistoryFilters] = useState({ mediaType: 'image', emotion: 'all' });\r\n  const [historyLoading, setHistoryLoading] = useState(false);\r\n  const [historyError, setHistoryError] = useState('');\r\n\r\n  const [imageFile, setImageFile] = useState(null);\r\n  const [imageChannel, setImageChannel] = useState('manual');\r\n  const [imageError, setImageError] = useState('');\r\n  const [imageLoading, setImageLoading] = useState(false);\r\n\r\n  const [videoFile, setVideoFile] = useState(null);\r\n  const [videoChannel, setVideoChannel] = useState('manual');\r\n  const [videoError, setVideoError] = useState('');\r\n  const [videoLoading, setVideoLoading] = useState(false);\r\n\r\n  const [webcamChannel, setWebcamChannel] = useState('webcam');\r\n  const [webcamError, setWebcamError] = useState('');\r\n  const [webcamLoading, setWebcamLoading] = useState(false);\r\n  const [isPreviewActive, setIsPreviewActive] = useState(false);\r\n  const [isRecording, setIsRecording] = useState(false);\r\n  const [recordingBlob, setRecordingBlob] = useState(null);\r\n  const [isLiveActive, setIsLiveActive] = useState(false);\r\n  const [liveResult, setLiveResult] = useState(null);\r\n  const [liveStatus, setLiveStatus] = useState('IA en espera');\r\n  const [liveError, setLiveError] = useState('');\r\n  const [liveSessionId, setLiveSessionId] = useState(null);\r\n  const [liveSessionStats, setLiveSessionStats] = useState(null);\r\n  const [liveSessionSummary, setLiveSessionSummary] = useState(null);\r\n\r\n  const videoRef = useRef(null);\r\n  const streamRef = useRef(null);\r\n  const recorderRef = useRef(null);\r\n  const overlayRef = useRef(null);\r\n  const captureCanvasRef = useRef(null);\r\n  const liveIntervalRef = useRef(null);\r\n  const liveRequestRef = useRef(false);\r\n  const webcamChannelRef = useRef(webcamChannel);\r\n  const liveSessionIdRef = useRef(liveSessionId);\r\n\r\n  const emotionOptions = availableEmotions.length > 0 ? availableEmotions : metadata?.labels || [];\r\n\r\n  const refreshHistory = useCallback(async () => {\r\n    setHistoryLoading(true);\r\n    setHistoryError('');\r\n    try {\r\n      const response = await fetchMediaHistory({\r\n        limit: 12,\r\n        mediaType: historyFilters.mediaType,\r\n        emotion: historyFilters.emotion,\r\n      });\r\n      setHistory(response.items || []);\r\n      setAvailableEmotions(response.filters?.available_emotions || []);\r\n    } catch (error) {\r\n      setHistoryError(error.response?.data?.message || 'No se pudo cargar el historial.');\r\n    } finally {\r\n      setHistoryLoading(false);\r\n    }\r\n  }, [historyFilters]);\r\n\r\n  const pushAnalyses = useCallback(\r\n    (analyses = []) => {\r\n      if (!Array.isArray(analyses) || analyses.length === 0) {\r\n        return;\r\n      }\r\n      setLatestResults((prev) => [...analyses, ...prev].slice(0, 5));\r\n      const filtered = analyses.filter((analysis) => {\r\n        const matchesType =\r\n          historyFilters.mediaType === 'all' || analysis.media_type === historyFilters.mediaType;\r\n        const matchesEmotion =\r\n          historyFilters.emotion === 'all' || analysis.dominant_emotion === historyFilters.emotion;\r\n        return matchesType && matchesEmotion;\r\n      });\r\n      if (filtered.length > 0) {\r\n        setHistory((prev) => [...filtered, ...prev].slice(0, 12));\r\n      }\r\n      refreshHistory().catch(() => {});\r\n    },\r\n    [historyFilters, refreshHistory]\r\n  );\r\n\r\n  const closeLiveSession = useCallback(async () => {\r\n    const sessionId = liveSessionIdRef.current;\r\n    if (!sessionId) {\r\n      return null;\r\n    }\r\n    try {\r\n      const response = await stopLiveSession(sessionId);\r\n      setLiveSessionSummary(response);\r\n      setLiveSessionStats(response);\r\n      if (response.analyses?.length) {\r\n        pushAnalyses(response.analyses);\r\n      }\r\n      return response;\r\n    } catch (error) {\r\n      setLiveError(error.response?.data?.message || 'No se pudo cerrar la sesión en vivo.');\r\n      return null;\r\n    } finally {\r\n      setLiveSessionId(null);\r\n      liveSessionIdRef.current = null;\r\n    }\r\n  }, [pushAnalyses]);\r\n\r\n  const clearOverlay = useCallback(() => {\r\n    const canvas = overlayRef.current;\r\n    if (canvas) {\r\n      const ctx = canvas.getContext('2d');\r\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    }\r\n  }, []);\r\n\r\n  const stopLiveLoop = useCallback(async () => {\r\n    if (liveIntervalRef.current) {\r\n      clearInterval(liveIntervalRef.current);\r\n      liveIntervalRef.current = null;\r\n    }\r\n    liveRequestRef.current = false;\r\n    const hadSession = Boolean(liveSessionIdRef.current);\r\n    setIsLiveActive(false);\r\n    setLiveStatus('IA en espera');\r\n    setLiveResult(null);\r\n    if (!hadSession) {\r\n      setLiveSessionStats(null);\r\n    }\r\n    clearOverlay();\r\n    if (hadSession) {\r\n      await closeLiveSession();\r\n    }\r\n  }, [clearOverlay, closeLiveSession]);\r\n\r\n  const drawDetections = useCallback((summary) => {\r\n    const overlay = overlayRef.current;\r\n    const videoElement = videoRef.current;\r\n    if (!overlay || !videoElement) {\r\n      return;\r\n    }\r\n    const displayWidth = videoElement.clientWidth || videoElement.videoWidth;\r\n    const displayHeight = videoElement.clientHeight || videoElement.videoHeight;\r\n    const intrinsicWidth = videoElement.videoWidth || displayWidth;\r\n    const intrinsicHeight = videoElement.videoHeight || displayHeight;\r\n    if (!displayWidth || !displayHeight || !intrinsicWidth || !intrinsicHeight) {\r\n      return;\r\n    }\r\n\r\n    overlay.width = displayWidth;\r\n    overlay.height = displayHeight;\r\n    overlay.style.width = `${displayWidth}px`;\r\n    overlay.style.height = `${displayHeight}px`;\r\n    const ctx = overlay.getContext('2d');\r\n    ctx.clearRect(0, 0, overlay.width, overlay.height);\r\n\r\n    const scaleX = displayWidth / intrinsicWidth;\r\n    const scaleY = displayHeight / intrinsicHeight;\r\n\r\n    const detections = summary?.detections || [];\r\n    if (detections.length === 0) {\r\n      setLiveStatus('IA en vivo: buscando rostros...');\r\n      return;\r\n    }\r\n\r\n    ctx.lineWidth = 2;\r\n    ctx.font = `${Math.max(14, overlay.width * 0.018)}px 'Space Grotesk', sans-serif`;\r\n    detections.forEach(({ box, label, confidence }) => {\r\n      const [rawX, rawY, rawW, rawH] = box;\r\n      const x = rawX * scaleX;\r\n      const y = rawY * scaleY;\r\n      const w = rawW * scaleX;\r\n      const h = rawH * scaleY;\r\n      ctx.strokeStyle = '#22d3ee';\r\n      ctx.strokeRect(x, y, w, h);\r\n\r\n      const text = `${label} ${(confidence * 100).toFixed(1)}%`;\r\n      const textWidth = ctx.measureText(text).width + 10;\r\n      const textHeight = parseInt(ctx.font, 10) + 6;\r\n      const labelY = Math.max(y - textHeight, 0);\r\n\r\n      ctx.fillStyle = 'rgba(15, 23, 42, 0.8)';\r\n      ctx.fillRect(x - 2, labelY, textWidth, textHeight);\r\n      ctx.fillStyle = '#fff';\r\n      ctx.fillText(text, x + 2, labelY + 4);\r\n    });\r\n  }, [setLiveStatus]);\r\n\r\n  useEffect(() => {\r\n    if (typeof document !== 'undefined' && !captureCanvasRef.current) {\r\n      captureCanvasRef.current = document.createElement('canvas');\r\n    }\r\n    return () => {\r\n      captureCanvasRef.current = null;\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    webcamChannelRef.current = webcamChannel;\r\n  }, [webcamChannel]);\r\n\r\n  useEffect(() => {\r\n    liveSessionIdRef.current = liveSessionId;\r\n  }, [liveSessionId]);\r\n\r\n  useEffect(() => {\r\n    refreshHistory().catch(() => {});\r\n  }, [refreshHistory]);\r\n\r\n  useEffect(() => {\r\n    const loadBootstrapData = async () => {\r\n      try {\r\n        const metaResponse = await fetchModelMetadata();\r\n        setMetadata(metaResponse);\r\n      } catch (error) {\r\n        setWebcamError(error.response?.data?.message || 'No se pudo obtener la configuración del modelo.');\r\n      }\r\n    };\r\n    loadBootstrapData();\r\n    return () => {\r\n      stopCamera();\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const updateHistoryFilter = (field) => (event) => {\r\n    const value = event.target.value;\r\n    setHistoryFilters((prev) => ({ ...prev, [field]: value }));\r\n  };\r\n\r\n  const handleImageSubmit = async (event) => {\r\n    event.preventDefault();\r\n    if (!imageFile) {\r\n      setImageError('Selecciona una imagen antes de enviar.');\r\n      return;\r\n    }\r\n    setImageLoading(true);\r\n    setImageError('');\r\n    try {\r\n      const response = await analyzeImageUpload(imageFile, imageChannel);\r\n      pushAnalyses(response.analyses);\r\n    } catch (error) {\r\n      setImageError(error.response?.data?.message || 'No se pudo analizar la imagen.');\r\n    } finally {\r\n      setImageLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleVideoSubmit = async (event) => {\r\n    event.preventDefault();\r\n    if (!videoFile) {\r\n      setVideoError('Selecciona un video MP4/WebM antes de enviar.');\r\n      return;\r\n    }\r\n    setVideoLoading(true);\r\n    setVideoError('');\r\n    try {\r\n      const response = await analyzeVideoUpload(videoFile, videoChannel);\r\n      pushAnalyses(response.analyses);\r\n    } catch (error) {\r\n      setVideoError(error.response?.data?.message || 'No se pudo analizar el video.');\r\n    } finally {\r\n      setVideoLoading(false);\r\n    }\r\n  };\r\n\r\n  const startCamera = async () => {\r\n    if (isPreviewActive) return;\r\n    if (!navigator.mediaDevices?.getUserMedia) {\r\n      setWebcamError('La API de cámara no está disponible en este navegador.');\r\n      setLiveError('');\r\n      return;\r\n    }\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\r\n      streamRef.current = stream;\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n      }\r\n      setIsPreviewActive(true);\r\n      setWebcamError('');\r\n      setLiveError('');\r\n      setLiveStatus('IA en espera');\r\n      setLiveResult(null);\r\n      setLiveSessionStats(null);\r\n      setLiveSessionSummary(null);\r\n      clearOverlay();\r\n    } catch (error) {\r\n      setWebcamError('No pudimos acceder a la cámara. Revisa los permisos del navegador o cierra otras aplicaciones que la estén usando.');\r\n      setLiveError('');\r\n    }\r\n  };\r\n\r\n  const stopCamera = useCallback(() => {\r\n    stopLiveLoop().catch(() => {});\r\n    streamRef.current?.getTracks().forEach((track) => track.stop());\r\n    streamRef.current = null;\r\n    if (videoRef.current) {\r\n      videoRef.current.srcObject = null;\r\n    }\r\n    setIsPreviewActive(false);\r\n    setIsRecording(false);\r\n    setRecordingBlob(null);\r\n    setLiveError('');\r\n    setLiveResult(null);\r\n    setLiveStatus('IA en espera');\r\n  }, [stopLiveLoop]);\r\n\r\n  const startLiveLoop = useCallback(async () => {\r\n    if (!streamRef.current || !videoRef.current) {\r\n      setLiveError('Activa la cámara antes de iniciar la IA en vivo.');\r\n      return;\r\n    }\r\n    if (!captureCanvasRef.current && typeof document !== 'undefined') {\r\n      captureCanvasRef.current = document.createElement('canvas');\r\n    }\r\n    if (liveIntervalRef.current || liveRequestRef.current || liveSessionIdRef.current) {\r\n      return;\r\n    }\r\n\r\n    let sessionResponse;\r\n    try {\r\n      sessionResponse = await startLiveSession(webcamChannelRef.current);\r\n    } catch (error) {\r\n      const apiMessage = error.response?.data?.message || error.response?.data?.msg;\r\n      if (error.response?.status === 401 || error.response?.status === 422) {\r\n        setLiveError('Tu sesión expiró. Inicia sesión nuevamente para usar la cámara en vivo.');\r\n      } else {\r\n        setLiveError(apiMessage || 'No se pudo iniciar la sesión en vivo.');\r\n      }\r\n      return;\r\n    }\r\n    setLiveSessionId(sessionResponse.session_id);\r\n    liveSessionIdRef.current = sessionResponse.session_id;\r\n    setLiveSessionStats(null);\r\n    setLiveSessionSummary(null);\r\n\r\n    const captureAndAnalyze = async () => {\r\n      if (!videoRef.current?.videoWidth || !captureCanvasRef.current) {\r\n        return;\r\n      }\r\n      if (liveRequestRef.current) {\r\n        return;\r\n      }\r\n      liveRequestRef.current = true;\r\n\r\n      const canvas = captureCanvasRef.current;\r\n      canvas.width = videoRef.current.videoWidth;\r\n      canvas.height = videoRef.current.videoHeight;\r\n      const ctx = canvas.getContext('2d');\r\n      ctx.drawImage(videoRef.current, 0, 0, canvas.width, canvas.height);\r\n\r\n      const blob = await new Promise((resolve) => canvas.toBlob(resolve, 'image/jpeg', 0.9));\r\n      if (!blob) {\r\n        liveRequestRef.current = false;\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const file = new File([blob], `webcam-frame-${Date.now()}.jpg`, { type: 'image/jpeg' });\r\n        const response = await analyzeWebcamFrame(\r\n          file,\r\n          webcamChannelRef.current,\r\n          liveSessionIdRef.current,\r\n        );\r\n        setLiveResult(response);\r\n        setLiveStatus(`IA en vivo: ${response.dominant_emotion} ${(response.confidence * 100).toFixed(1)}%`);\r\n        drawDetections(response);\r\n        setLiveError('');\r\n        if (response.session) {\r\n          setLiveSessionStats(response.session);\r\n        }\r\n      } catch (error) {\r\n        const apiMessage = error.response?.data?.message || 'No se pudo analizar el fotograma de la cámara.';\r\n        if (error.response?.status === 400) {\r\n          setLiveStatus(`IA en vivo: ${apiMessage}`);\r\n          setLiveError('');\r\n          clearOverlay();\r\n        } else {\r\n          setLiveError(apiMessage);\r\n          stopLiveLoop().catch(() => {});\r\n        }\r\n      } finally {\r\n        liveRequestRef.current = false;\r\n      }\r\n    };\r\n\r\n    setIsLiveActive(true);\r\n    setLiveStatus('IA en vivo: calibrando cámara...');\r\n    setLiveError('');\r\n    captureAndAnalyze();\r\n    liveIntervalRef.current = window.setInterval(captureAndAnalyze, 1800);\r\n  }, [drawDetections, stopLiveLoop]);\r\n\r\n  useEffect(() => {\r\n    if (!isPreviewActive) {\r\n      return undefined;\r\n    }\r\n    const handleKeyPress = (event) => {\r\n      const key = event.key?.toLowerCase();\r\n      if (key === 'p') {\r\n        event.preventDefault();\r\n        startLiveLoop().catch(() => {});\r\n      } else if (key === 'q') {\r\n        event.preventDefault();\r\n        if (isLiveActive) {\r\n          stopLiveLoop().catch(() => {});\r\n        }\r\n        stopCamera();\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handleKeyPress);\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyPress);\r\n    };\r\n  }, [isPreviewActive, isLiveActive, startLiveLoop, stopLiveLoop, stopCamera]);\r\n\r\n  const startRecording = () => {\r\n    if (!streamRef.current) {\r\n      setWebcamError('Activa la cámara antes de grabar.');\r\n      return;\r\n    }\r\n    if (isRecording) return;\r\n    if (typeof MediaRecorder === 'undefined') {\r\n      setWebcamError('MediaRecorder no es compatible con este navegador.');\r\n      return;\r\n    }\r\n\r\n    let recorder;\r\n    try {\r\n      recorder = new MediaRecorder(streamRef.current, {\r\n        mimeType: 'video/webm;codecs=vp9',\r\n      });\r\n    } catch (error) {\r\n      try {\r\n        recorder = new MediaRecorder(streamRef.current);\r\n      } catch (err) {\r\n        setWebcamError('No se pudo iniciar la grabación en este navegador.');\r\n        return;\r\n      }\r\n    }\r\n    const chunks = [];\r\n    recorder.ondataavailable = (event) => {\r\n      if (event.data?.size) {\r\n        chunks.push(event.data);\r\n      }\r\n    };\r\n    recorder.onstop = () => {\r\n      setIsRecording(false);\r\n      const blob = new Blob(chunks, { type: 'video/webm' });\r\n      setRecordingBlob(blob);\r\n    };\r\n    recorder.onerror = () => {\r\n      setWebcamError('Ocurrió un error durante la grabación.');\r\n      recorder.stop();\r\n    };\r\n\r\n    recorder.start();\r\n    recorderRef.current = recorder;\r\n    setIsRecording(true);\r\n\r\n    setTimeout(() => {\r\n      if (recorder.state !== 'inactive') {\r\n        recorder.stop();\r\n      }\r\n    }, 5000);\r\n  };\r\n\r\n  const stopRecording = () => {\r\n    if (recorderRef.current && recorderRef.current.state !== 'inactive') {\r\n      recorderRef.current.stop();\r\n    }\r\n  };\r\n\r\n  const handleWebcamSubmit = async () => {\r\n    if (!recordingBlob) {\r\n      setWebcamError('Graba un clip antes de enviarlo.');\r\n      return;\r\n    }\r\n    setWebcamLoading(true);\r\n    setWebcamError('');\r\n    try {\r\n      const file = new File([recordingBlob], `webcam-${Date.now()}.webm`, { type: recordingBlob.type || 'video/webm' });\r\n      const response = await analyzeWebcamUpload(file, webcamChannel);\r\n      pushAnalyses(response.analyses);\r\n      setRecordingBlob(null);\r\n    } catch (error) {\r\n      setWebcamError(error.response?.data?.message || 'No se pudo analizar la captura de la cámara.');\r\n    } finally {\r\n      setWebcamLoading(false);\r\n    }\r\n  };\r\n\r\n  const livePanelData = liveSessionStats || liveResult;\r\n  const livePanelCounts = livePanelData?.counts || {};\r\n  const liveSummaryAnalyses = liveSessionSummary?.analyses?.length\r\n    ? liveSessionSummary.analyses\r\n    : liveSessionSummary?.analysis\r\n    ? [liveSessionSummary.analysis]\r\n    : [];\r\n  const liveSummaryPrimary = liveSummaryAnalyses[0];\r\n  const resolveEmotionCount = (analysis) => {\r\n    if (!analysis) return 0;\r\n    if (analysis.detections?.emotion_count != null) {\r\n      return analysis.detections.emotion_count;\r\n    }\r\n    if (analysis.detections?.counts?.[analysis.dominant_emotion] != null) {\r\n      return analysis.detections.counts[analysis.dominant_emotion];\r\n    }\r\n    if (analysis.emotion_counts?.length) {\r\n      return analysis.emotion_counts[0].count;\r\n    }\r\n    return 1;\r\n  };\r\n\r\n  return (\r\n    <section className=\"app-container\">\r\n      {/* Filtro de emociones removido por solicitud */}\r\n      <div className=\"page-header\">\r\n        <h1 className=\"page-title\">Laboratorio multimedia</h1>\r\n        <p className=\"page-subtitle\">\r\n          Carga imágenes, videos o captura directamente desde la cámara para detectar emociones en tiempo real.\r\n        </p>\r\n      </div>\r\n\r\n      {metadata && (\r\n        <div className=\"card media-info-card\">\r\n          <h3>Modelo activo</h3>\r\n          <p>Pesos: {metadata.weights_path}</p>\r\n          <div className=\"media-pills\">\r\n            {metadata.labels?.map((label) => (\r\n              <span className=\"media-pill\" key={label}>\r\n                {label}\r\n              </span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"media-camera-wrapper\">\r\n        <div className=\"card media-card media-webcam-card\">\r\n          <h3>Capturar desde la cámara</h3>\r\n          <p>Activa la cámara, habilita la IA en vivo para ver detecciones sobre el rostro o graba un clip de 5 segundos.</p>\r\n          <div className=\"media-webcam\">\r\n            <div className=\"media-webcam-layout\">\r\n              <div className=\"media-webcam-preview\">\r\n                <video ref={videoRef} className=\"media-preview\" autoPlay muted playsInline />\r\n                <canvas ref={overlayRef} className=\"media-overlay\" />\r\n              </div>\r\n              <div className=\"media-webcam-panel\">\r\n                <div className=\"media-live-status\">\r\n                  <span className={`media-live-indicator ${isLiveActive ? 'on' : ''}`} />\r\n                  <div>\r\n                    <p className=\"media-live-headline\">{liveStatus}</p>\r\n                    {livePanelData && (\r\n                      <p className=\"media-live-subtitle\">\r\n                        Dominante: <strong>{livePanelData.dominant_emotion || 'Sin detección'}</strong> · {((livePanelData.confidence ?? 0) * 100).toFixed(1)}%\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                <div className=\"media-actions\">\r\n                  <button type=\"button\" className=\"secondary-btn\" onClick={startCamera} disabled={isPreviewActive}>\r\n                    Activar cámara\r\n                  </button>\r\n                  <button type=\"button\" className=\"secondary-btn\" onClick={stopCamera}>\r\n                    Detener cámara\r\n                  </button>\r\n                  <button type=\"button\" className=\"secondary-btn\" onClick={startRecording} disabled={!isPreviewActive || isRecording}>\r\n                    {isRecording ? 'Grabando...' : 'Grabar 5s'}\r\n                  </button>\r\n                  <button type=\"button\" className=\"secondary-btn\" onClick={stopRecording} disabled={!isRecording}>\r\n                    Detener grabación\r\n                  </button>\r\n                </div>\r\n                <div className=\"media-actions media-live-actions\">\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"secondary-btn\"\r\n                    onClick={() => startLiveLoop().catch(() => {})}\r\n                    disabled={!isPreviewActive || isLiveActive}\r\n                  >\r\n                    {isLiveActive ? 'IA en vivo activa' : 'Activar IA en vivo'}\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"secondary-btn\"\r\n                    onClick={() => stopLiveLoop().catch(() => {})}\r\n                    disabled={!isLiveActive && !liveSessionId}\r\n                  >\r\n                    Detener IA en vivo\r\n                  </button>\r\n                </div>\r\n                <p className=\"media-hint\">\r\n                  Atajos: presiona <strong>P</strong> para iniciar la IA en vivo y <strong>Q</strong> para detener la cámara.\r\n                </p>\r\n                {recordingBlob && <p className=\"media-hint\">Clip listo para enviar ({(recordingBlob.size / 1024 / 1024).toFixed(2)} MB)</p>}\r\n                {/* Label de canal eliminado */}\r\n                {webcamError && <p className=\"media-error\">{webcamError}</p>}\r\n                {liveError && <p className=\"media-error\">{liveError}</p>}\r\n                <button className=\"primary-btn\" type=\"button\" onClick={handleWebcamSubmit} disabled={webcamLoading || !recordingBlob}>\r\n                  {webcamLoading ? 'Enviando...' : 'Analizar clip grabado'}\r\n                </button>\r\n                {livePanelData && (\r\n                  <div className=\"media-live-panel\">\r\n                    <p className=\"media-live-emotion\">\r\n                      {livePanelData.dominant_emotion || 'Sin detección'}\r\n                      <span>{((livePanelData.confidence ?? 0) * 100).toFixed(1)}%</span>\r\n                    </p>\r\n                    {Object.keys(livePanelCounts).length > 0 && (\r\n                      <div className=\"media-live-counts\">\r\n                        {Object.entries(livePanelCounts).map(([label, qty]) => (\r\n                          <span key={label}>\r\n                            {label}\r\n                            <strong>{qty}</strong>\r\n                          </span>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                    {liveSessionStats?.frames && (\r\n                      <p className=\"media-hint\" style={{ margin: 0 }}>\r\n                        Muestras procesadas: {liveSessionStats.frames}\r\n                        {liveSessionSummary?.duration_seconds && (\r\n                          <span> · Duración {(liveSessionSummary.duration_seconds / 60).toFixed(1)} min</span>\r\n                        )}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                )}\r\n                {liveSummaryAnalyses.length > 0 && liveSummaryPrimary && (\r\n                  <div className=\"media-live-panel\" style={{ background: 'rgba(22, 163, 74, 0.1)' }}>\r\n                    <p className=\"media-live-emotion\" style={{ fontSize: '1rem' }}>\r\n                      Sesión guardada correctamente\r\n                      <span>\r\n                        {new Date(liveSummaryPrimary.created_at).toLocaleTimeString()} · {liveSummaryAnalyses.length}{' '}\r\n                        {liveSummaryAnalyses.length === 1 ? 'emoción' : 'emociones'}\r\n                      </span>\r\n                    </p>\r\n                    <div className=\"media-links\">\r\n                      {liveSummaryPrimary.snapshot_url && (\r\n                        <a href={liveSummaryPrimary.snapshot_url} target=\"_blank\" rel=\"noreferrer\">\r\n                          Ver captura principal\r\n                        </a>\r\n                      )}\r\n                      {liveSummaryPrimary.original_url && (\r\n                        <a href={liveSummaryPrimary.original_url} target=\"_blank\" rel=\"noreferrer\">\r\n                          Descargar sesión\r\n                        </a>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"media-live-counts\">\r\n                      {liveSummaryAnalyses.map((analysis) => (\r\n                        <span key={`live-summary-${analysis.id}`}>\r\n                          {analysis.dominant_emotion}\r\n                          <strong>{resolveEmotionCount(analysis)}</strong>\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"media-upload-grid\">\r\n        <div className=\"card media-card\">\r\n          <h3>Analizar imagen</h3>\r\n          <p>Carga una fotografía (JPG, PNG, WEBP) y obtén el sentimiento dominante.</p>\r\n          <form onSubmit={handleImageSubmit} className=\"media-form\">\r\n            <input type=\"file\" accept=\"image/*\" onChange={(event) => setImageFile(event.target.files?.[0] || null)} />\r\n            {/* Selector de canal eliminado completamente */}\r\n            {imageError && <p className=\"media-error\">{imageError}</p>}\r\n            <button className=\"primary-btn\" type=\"submit\" disabled={imageLoading}>\r\n              {imageLoading ? 'Analizando...' : 'Procesar imagen'}\r\n            </button>\r\n          </form>\r\n        </div>\r\n\r\n        <div className=\"card media-card\">\r\n          <h3>Analizar video</h3>\r\n          <p>Sube un clip MP4/MOV/WebM para procesar múltiples fotogramas.</p>\r\n          <form onSubmit={handleVideoSubmit} className=\"media-form\">\r\n            <input type=\"file\" accept=\"video/mp4,video/webm,video/quicktime\" onChange={(event) => setVideoFile(event.target.files?.[0] || null)} />\r\n            {/* Selector de canal eliminado completamente */}\r\n            {videoError && <p className=\"media-error\">{videoError}</p>}\r\n            <button className=\"primary-btn\" type=\"submit\" disabled={videoLoading}>\r\n              {videoLoading ? 'Analizando...' : 'Procesar video'}\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n\r\n      {latestResults.length > 0 && (\r\n        <div style={{ marginTop: '2rem' }}>\r\n          <h2>Últimos resultados</h2>\r\n          <div className=\"media-result-list\">\r\n            {latestResults.map((item) => (\r\n              <MediaResultCard key={`${item.id}-${item.created_at}`} item={item} />\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div style={{ marginTop: '2rem' }}>\r\n        <div className=\"media-history-header\">\r\n          <h2>Historial almacenado</h2>\r\n          <div className=\"media-filter-bar\">\r\n            <label>\r\n              Tipo de medio\r\n              <select value={historyFilters.mediaType} onChange={updateHistoryFilter('mediaType')}>\r\n                <option value=\"image\">Fotos</option>\r\n                <option value=\"video\">Videos</option>\r\n                <option value=\"all\">Todos</option>\r\n              </select>\r\n            </label>\r\n            <label>\r\n              Sentimiento\r\n              <select value={historyFilters.emotion} onChange={updateHistoryFilter('emotion')}>\r\n                <option value=\"all\">Todos</option>\r\n                {emotionOptions.map((label) => (\r\n                  <option key={label} value={label}>\r\n                    {label}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </label>\r\n          </div>\r\n        </div>\r\n        {historyError && <p className=\"media-error\">{historyError}</p>}\r\n        {historyLoading ? (\r\n          <p className=\"media-hint\">Cargando registros...</p>\r\n        ) : history.length === 0 ? (\r\n          <p className=\"media-hint\">Aún no hay registros almacenados para este usuario.</p>\r\n        ) : (\r\n          <div className=\"media-result-list\">\r\n            {history.map((item) => (\r\n              <MediaResultCard key={`history-${item.id}`} item={item} />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n\r\nexport default MediaLab;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}